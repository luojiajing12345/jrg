<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no,maximum-scale=1.0,minimum-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
	<link rel="stylesheet" href="css/canvas_style.css" />
	<title>Document</title>
</head>
<body>
	<canvas id="canvas"></canvas>
	<div id='actions' class="actions">
		<button id='eraser'>橡皮擦</button>
		<button id='brush'>画笔</button>
	</div>

	<script type="text/javascript">
		var canvas = document.getElementById('canvas')
		var context = canvas.getContext('2d');
		
		canvasSize(canvas)

/***/
		listenToUser(canvas)

		
		//使画板宽高和页面宽高一样大小

		var eraserEnable = false
		eraser.onclick = function(){
			eraserEnable =true
			actions.className='actions x'
		}
		brush.onclick = function(){
			eraserEnable = false
			actions.className='actions'
		}
		
		
		function canvasSize(canvas){
			wAndH()
			window.onresize =function(){
				wAndH()
			}
			
			function wAndH(){
				var drawWidth = document.documentElement.clientWidth
				var drawHeight = document.documentElement.clientHeight
				canvas.width = drawWidth
				canvas.height = drawHeight
			}
		}
		
		//**//
		function listenToUser(){
			var lastPoint = {x:undefined,y:undefined}
			function drawCirular(x,y,radius){
				context.beginPath()
				context.arc(x,y,radius,0,Math.PI*2)
				context.fill()
			}
			var using = false
			if(document.body.ontouchstart !== undefined){
				//触屏设备
				canvas.ontouchstart = function(aaa){
					using = true
					var x = aaa.touches[0].clientX
					var y = aaa.touches[0].clientY
				}
				canvas.ontouchmove = function(aaa){
					var x = aaa.touches[0].clientX
					var y = aaa.touches[0].clientY
					if(!using){
						return
					}
					if(eraserEnable){
						context.clearRect(x,y,20,20)
					}else{
						var newPoint = {x:x,y:y}
						drawConnect(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
						lastPoint = newPoint		
					}
				}
				canvas.ontouchend = function(){
					using = false
					console.log('end')
				}
			}else{
				//非触屏设备
				canvas.onmousedown = function(a){
				x = a.clientX
				y = a.clientY
				using =true
				if(eraserEnable){
			 		context.clearRect(x-5,y-5,10,10)
 				}else{
					lastPoint = {x:x,y:y}
 					}
				}
				canvas.onmousemove = function(a){
				x = a.clientX
				y = a.clientY
				if(!using){
					return
				}
				if(eraserEnable){
					context.clearRect(x,y,20,20)
				}else{
					var newPoint = {x:x,y:y}
					drawConnect(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
					lastPoint = newPoint		
					}
				}
				canvas.onmouseup =function(a){
					using = false
				}
			}
 			
			function drawConnect(x1,y1,x2,y2){
				context.beginPath()
				context.moveTo(x1,y1)
				context.lineWidth = 4
				context.lineTo(x2,y2)
				context.stroke()
			}
		}
		

	</script>
</body>
</html>